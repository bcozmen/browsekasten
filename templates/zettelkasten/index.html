{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="zettelkasten-container">
    <div class="column" id="column1" style="width : 10%">
        {% include "zettelkasten/file_manager.html" %}
    </div>
    <div class="resizer" id="resizer1"></div>
    <div class="column" id="column2" style="width: 45%;">
        {% include "zettelkasten/editor.html" %}
    </div>
    <div class="resizer" id="resizer2"></div>
    <div class="column" id="column3" style="width: 45%;">
        {% include "zettelkasten/viewer.html" %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/zettelkasten.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
//resize functionality
document.addEventListener('DOMContentLoaded', function() {
    const resizers = document.querySelectorAll('.resizer');
    const columns = document.querySelectorAll('.column');
    
    // Load saved widths from localStorage
    columns.forEach(column => {
        const savedWidth = localStorage.getItem(`column-width-${column.id}`);
        if (savedWidth) {
            column.style.width = savedWidth;
        }
    });
    
    let isResizing = false;
    let currentResizer;
    let prevColumn;
    let nextColumn;
    let prevColumnWidth;
    let nextColumnWidth;
    let startX;

    resizers.forEach(resizer => {
        resizer.addEventListener('mousedown', initResize);
    });

    function initResize(e) {
        isResizing = true;
        currentResizer = e.target;
        prevColumn = currentResizer.previousElementSibling;
        nextColumn = currentResizer.nextElementSibling;
        startX = e.pageX;

        prevColumnWidth = prevColumn.offsetWidth;
        nextColumnWidth = nextColumn.offsetWidth;

        document.addEventListener('mousemove', resize);
        document.addEventListener('mouseup', stopResize);
    }

    function resize(e) {
        if (!isResizing) return;
        
        const diff = e.pageX - startX;
        
        // Calculate new widths
        const newPrevWidth = prevColumnWidth + diff;
        const newNextWidth = nextColumnWidth - diff;
        
        // Set minimum width (100px)
        if (newPrevWidth >= 100 && newNextWidth >= 100) {
            prevColumn.style.width = newPrevWidth + 'px';
            nextColumn.style.width = newNextWidth + 'px';
        }
    }

    function stopResize() {
        isResizing = false;
        document.removeEventListener('mousemove', resize);
        document.removeEventListener('mouseup', stopResize);

        // Save the new widths to localStorage
        columns.forEach(column => {
            localStorage.setItem(`column-width-${column.id}`, column.style.width);
        });
    }
});
</script>
{% endblock %}

