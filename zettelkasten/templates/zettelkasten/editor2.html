<style>
  .markdown-editor-form {
      width: 100%; 
      height: 100%;
  }
  .markdown-editor-form:focus {
      outline: none;
      border: none;
  }
  .markdown-editor {
      width: 100%; 
      height: 100%;
      background-color: transparent;
      outline: none;
      border: none;
      display: none;

  }
  .markdown-editor:focus {
      outline: none;
      border: none;
  }
  .editor {
      /* Added so editor is visible */
      width: 100%;
      height: 400px;  /* adjust as needed */
      border: 1px solid #ccc;
  }
</style>

<form method="post" class="markdown-editor-form" onsubmit="saveEditorContent()">
  {% csrf_token %}
  <textarea name="content" id="markdown-editor" class="markdown-editor">{{ initial_markdown }}</textarea>
  <div id="editor" class="editor"></div>
  <button type="submit">Save</button>
</form>

<script type="module">
  import {EditorView, basicSetup} from "https://cdn.skypack.dev/@codemirror/basic-setup";
  import {EditorState} from "https://cdn.skypack.dev/@codemirror/state";
  import {markdown} from "https://cdn.skypack.dev/@codemirror/lang-markdown";
  import {oneDark} from "https://cdn.skypack.dev/@codemirror/theme-one-dark";
  import {keymap} from "https://cdn.skypack.dev/@codemirror/view";
  import {defaultKeymap} from "https://cdn.skypack.dev/@codemirror/commands";

  // Get initial content from the hidden textarea
  const initialContent = document.getElementById('markdown-editor').value;

  // Create the editor
  const state = EditorState.create({
    doc: initialContent,
    extensions: [
      basicSetup,
      markdown(),
      oneDark,
      keymap.of(defaultKeymap)
    ]
  });

  const view = new EditorView({
    state,
    parent: document.getElementById('editor')
  });

  // Function to save editor content into hidden field before submit
  window.saveEditorContent = function () {
    document.getElementById('markdown-editor').value = view.state.doc.toString();
  };

  let markdownEditor = document.getElementById('markdown-editor');
  markdownEditor.addEventListener('input', ...);
</script>
