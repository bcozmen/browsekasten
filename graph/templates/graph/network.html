{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
    html, body, main {
        height: 100%;
        min-height: 100vh;
    }
    .network {
        width: 100%;
        height:100%;
        min-height: 300px;
        min-width: 300px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex: 1 1 auto;
    }
    #network-interface {
        width: 100%;
        height: 100%;
        min-width: 300px;
        min-height: 300px;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.1);
        background-color: #fff;
    }
</style>


<div class="network">
    <div id="network-interface">

    </div>
</div>

<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    

<script>
    // Pass Django-provided JSON safely into JavaScript
    const elements = {{ graph_data_json|safe }};

    // Helper to get CSS variable value
    function getCSSVar(varName) {
        return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    }

    // Get relevant CSS variables
    const nodeColor = getCSSVar('--primary-700') || '#3d7a4f';
    const nodeTextColor = getCSSVar('--text-light') || '#fff';
    const nodeBorderColor = getCSSVar('--primary-900') || '#1a472a';
    const edgeColor = getCSSVar('--ui-border') || '#8dca9f';
    const edgeArrowColor = getCSSVar('--primary-200') || '#8dca9f';
    const bgColor = getCSSVar('--bg-primary') || '#e8eee8';

    // Set background color for the network interface
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('network-interface').style.backgroundColor = bgColor;
    });

    // Initialize Cytoscape
    const cy = cytoscape({
        container: document.getElementById('network-interface'),
        elements: elements,
        style: [
            {
                selector: 'node',
                style: {
                    'label': 'data(label)',
                    'background-color': nodeColor,
                    'color': nodeTextColor,
                    'text-valign': 'center',
                    'text-halign': 'center',
                    'border-width': 2,
                    'border-color': nodeBorderColor,
                    'font-size': 16,
                    'text-outline-width': 2,
                    'text-outline-color': nodeColor,
                    'width': 40,
                    'height': 40,
                    'shape': 'ellipse',
                    'shadow-blur': 8,
                    'shadow-color': 'rgba(0,0,0,0.08)',
                    'shadow-offset-x': 0,
                    'shadow-offset-y': 2
                }
            },
            {
                selector: 'edge',
                style: {
                    'width': 2,
                    'line-color': edgeColor,
                    'target-arrow-color': edgeArrowColor,
                    'target-arrow-shape': 'triangle',
                    'curve-style': 'bezier',
                    'arrow-scale': 1.2
                }
            }
        ],
        layout: {
            name: 'cose',
            animate: true
        }
    });
</script>
{% endblock %}